library(move)
library(tidyverse)
library(lubridate)
library(ggmap)
library(scales)
library(dplyr)
library(lme4)
load(file="~/ownCloud/PhDLife/P.hastatus/2021-10-Camila-secondseason/Analysis/Manuscript/data/Phyllostomus_HMMbehaviors.RData")
# change name of data frame
allbats_Bocas <- bats_behaviors
#check at tracking data again!
lapply(split(allbats_Bocas, allbats_Bocas$ID), function(x){
ggplot(aes(x=location_long, y=location_lat), data=x)+geom_point()+
ggtitle(x$ID)
})
# add columns with the coordinate of the caves
allbats_Bocas$location_lat_cave <- NA
allbats_Bocas$location_long_cave <- NA
allbats_Bocas$location_lat_cave[which(allbats_Bocas$cave=="lagruta")] <- 9.396448
allbats_Bocas$location_long_cave[which(allbats_Bocas$cave=="lagruta")] <- -82.271541
allbats_Bocas$location_lat_cave[which(allbats_Bocas$cave=="ajcave")] <- 9.440312
allbats_Bocas$location_long_cave[which(allbats_Bocas$cave=="ajcave")] <- -82.274955
allbats_Bocas$location_lat_cave[which(allbats_Bocas$cave=="muddycave")] <- 9.387233
allbats_Bocas$location_long_cave[which(allbats_Bocas$cave=="muddycave")] <- -82.264753
unique(allbats_Bocas$tag_local_identifier)
# calculate point euclidean distance from the cave all the points. Gives the distance in meters
allbats_Bocas$distanceFromCave <- pointDistance(allbats_Bocas[,c("location_long","location_lat")], allbats_Bocas[,c("location_long_cave", "location_lat_cave")], lonlat = T)
# extract maximum distance
maxdist <-aggregate(distanceFromCave~ID_batday+tag_local_identifier+year_cave+cave, allbats_Bocas, FUN=max)
# convert distnace in meters to Km
maxdist$maxkm <- maxdist$distanceFromCave/1000
# need to check which ones do I leave
maxdist[which(maxdist$maxkm<2),]
# remove some distances which might not be accurate since the individuals did not travel much and there are few points
maxdist_c <- maxdist %>%
filter(ID_batday!="74F9F83_3", ID_batday!="38500337_C_1",ID_batday!="0C506E35_C_1",ID_batday!="0C506E35_C_2",ID_batday!="0D501435_C_1", ID_batday!="74DA035_1", ID_batday!="74DC454_1", ID_batday!="74DDA80_2", ID_batday!="74DDFB1_1", ID_batday!="74FE24E_3", ID_batday!="PH_TS_018_7")
# make a summary table per individual
maxNSD_df_id <- maxdist_c %>%
group_by(tag_local_identifier, year_cave, cave) %>%
dplyr::summarise(mean_dist=mean(maxkm), sd=sd(maxkm))
table(maxNSD_df_id$year_cave)
maxNSD_df_id$sex <- allbats_Bocas$sex[match(maxNSD_df_id$tag_local_identifier, allbats_Bocas$tag_local_identifier)]
#summary of number of individuals used by sex
table(maxNSD_df_id$year_cave, maxNSD_df_id$sex)
# number individuals to the summary table
# p <- as.data.frame(table(maxNSD_df_id$year_cave,maxNSD_df_id$tag_local_identifier))
# l <- count(p$Var1[which(p$Freq>0)])
# summary table per cave
maxddist_cave <- maxdist_c %>%
group_by(year_cave) %>%
dplyr::summarise(mean_dist=mean(maxkm), sd=sd(maxkm))
hist(maxNSD_df_id$mean_dist)
glmer(mean_dist~year_cave+ (1|), data=maxNSD_df_id, family=Gamma(link = "inverse"))
View(maxNSD_df_id)
glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "inverse"))
glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"))
glm(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"))
anova(m1)
library(broom.mixed) ###Other p-values (not global)
install.packages("broom.mixed")
library(broom.mixed) ###Other p-values (not global)
tidy(m1,conf.int=TRUE,exponentiate=TRUE,effects="ran_vals")
summary(m1)
car::Anova(m1)
car::Anova(m1, type=3)
## Test distance with non-parametric test
useful website
# Post-hoc analysis
library (multcomp)
summary(glht(m1, mcp(Sound="Tukey")))
summary(glht(m1, mcp(year_cave="Tukey")))
summary(m1)
summary(glht(m1, mcp(year_cave="Tukey")))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id))
hist(maxNSD_df_id$mean_dist)
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "identity"))
-(maxNSD_df_id$mean_dist)
hist(-(maxNSD_df_id$mean_dist))
maxNSD_df_id$dist_transf <- hist(-(maxNSD_df_id$mean_dist))
maxNSD_df_id$dist_transf <- -(maxNSD_df_id$mean_dist))
maxNSD_df_id$dist_transf <- -(maxNSD_df_id$mean_dist)
maxNSD_df_id$dist_transf
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"))
summary(m1)
m1 <- glmer(dist_transf~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"))
hist(-(maxNSD_df_id$mean_dist))
hist(maxNSD_df_id$mean_dist)
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "logit"))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "link"))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "inverse"))
summary(m1)
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "inverse"))
summary(m1)
hist(log(maxNSD_df_id$mean_dist))
hist(exp((maxNSD_df_id$mean_dist))
hist(-(maxNSD_df_id$mean_dist))
hist(-(maxNSD_df_id$mean_dist))
maxNSD_df_id$dist_transf<- -1*maxNSD_df_id$mean_dist
maxNSD_df_id$dist_transf
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "log"))
summary(m1)
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "log"), control=glmerControl(optimizer="bobyqa",
optCtrl=list(maxfun=2e5)))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"), control=glmerControl(optimizer="bobyqa",
optCtrl=list(maxfun=2e5)))
m1 <- glmer(dist_transf~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"), control=glmerControl(optimizer="bobyqa",
optCtrl=list(maxfun=2e5)))
m1 <- glmer(dist_transf~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "identity"), control=glmerControl(optimizer="bobyqa",
optCtrl=list(maxfun=2e5)))
m1 <- glmer(dist_transf~year_cave + (1|tag_local_identifier), data=maxNSD_df_id, family=gaussian(link = "log"), control=glmerControl(optimizer="bobyqa",
optCtrl=list(maxfun=2e5)))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "idenity"))
m1 <- glmer(mean_dist~year_cave+ (1|tag_local_identifier), data=maxNSD_df_id, family=Gamma(link = "identity"))
summary(m1)
# Post-hoc analysis
library (multcomp)
summary(glht(m1, mcp(year_cave="Tukey")))
